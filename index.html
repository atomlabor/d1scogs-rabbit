        document.getElementById('scanResult').style.display = 'none';
      }

      async function onBarcode(code) {
        try {
          // Search Discogs by barcode/UPC/EAN
          const q = encodeURIComponent(code);
          const data = await discogsFetch(`https://api.discogs.com/database/search?barcode=${q}`);
          const r = (data && data.results && data.results[0]) ? data.results[0] : null;
          if (r) {
            document.getElementById('resImg').src = r.cover_image || '';
            document.getElementById('resTitle').textContent = r.title || '';
            const sub = [];
            if (r.year) sub.push(r.year);
            if (r.country) sub.push(r.country);
            document.getElementById('resSub').textContent = sub.join(' • ');
            document.getElementById('scanResult').style.display = 'grid';
          } else {
            alert('Keine Treffer für Barcode: ' + code);
          }
        } catch (e) {
          console.error(e);
          alert('Suche fehlgeschlagen: ' + e.message);
        }
      }

      // Auto-login if credentials exist
      window.addEventListener('DOMContentLoaded', () => {
        if (store.token && store.user) {
          document.getElementById('token').value = store.token;
          document.getElementById('username').value = store.user;
          showLogin(false);
          setActiveTab('collection');
          loadCollection();
        } else {
          showLogin(true);
        }
      });
    </script>
  </body>
</html>
